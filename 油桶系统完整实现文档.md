# æ²¹æ¡¶ç³»ç»Ÿå®Œæ•´å®ç°æ–‡æ¡£

## ğŸ¯ åŠŸèƒ½æ¦‚è¿°

ç±»ä¼¼ã€Šåƒµå°¸å±æœº3ã€‹çš„æ²¹æ¡¶ç³»ç»Ÿï¼š

- âœ… ç©å®¶å¯ä»¥æ”¾ç½®æ²¹æ¡¶ï¼ˆæ¨¡å¼3ï¼‰
- âœ… æ²¹æ¡¶æœ‰è¡€é‡ï¼Œå¯è¢«å­å¼¹ä¼¤å®³
- âœ… æ²¹æ¡¶è¡€é‡å½’é›¶æ—¶çˆ†ç‚¸
- âœ… çˆ†ç‚¸é€ æˆèŒƒå›´ä¼¤å®³
- âœ… æ”¯æŒè¿é”çˆ†ç‚¸ï¼ˆæ²¹æ¡¶å¼•çˆ†æ²¹æ¡¶ï¼‰
- âœ… çˆ†ç‚¸å¯ä¼¤å®³ç©å®¶ã€åƒµå°¸ã€å¢™ã€å…¶ä»–æ²¹æ¡¶

---

## ğŸ“¦ æ ¸å¿ƒç»„ä»¶

### 1. BarrelComponentï¼ˆæ²¹æ¡¶ç»„ä»¶ï¼‰

```csharp
public struct BarrelComponent : IComponent
{
    public Fix64 maxHp;              // æœ€å¤§è¡€é‡
    public Fix64 currentHp;          // å½“å‰è¡€é‡
    public Fix64 explosionRadius;    // çˆ†ç‚¸èŒƒå›´
    public Fix64 explosionDamage;    // çˆ†ç‚¸ä¼¤å®³
    public bool isDestroyed;         // æ˜¯å¦å·²æ‘§æ¯
    public int ownerId;              // æ‰€å±ç©å®¶
}
```

**é»˜è®¤é…ç½®**ï¼š
- è¡€é‡ï¼š50
- çˆ†ç‚¸èŒƒå›´ï¼š3å•ä½
- çˆ†ç‚¸ä¼¤å®³ï¼š40

### 2. ExplosionComponentï¼ˆçˆ†ç‚¸ç»„ä»¶ï¼‰

```csharp
public struct ExplosionComponent : IComponent
{
    public FixVector2 position;      // çˆ†ç‚¸ä¸­å¿ƒ
    public Fix64 radius;             // çˆ†ç‚¸èŒƒå›´
    public Fix64 damage;             // çˆ†ç‚¸ä¼¤å®³
    public bool hasDealDamage;       // æ˜¯å¦å·²é€ æˆä¼¤å®³
    public int lifetimeFrames;       // ç”Ÿå‘½å‘¨æœŸï¼ˆå¸§ï¼‰
    public int currentFrame;         // å½“å‰å¸§
    public int ownerId;              // æ‰€å±ç©å®¶
}
```

**ç”Ÿå‘½å‘¨æœŸ**ï¼š
- ç¬¬1å¸§ï¼šåˆ›å»ºï¼Œé€ æˆä¼¤å®³
- ç¬¬2-10å¸§ï¼šè§†è§‰æ•ˆæœ
- ç¬¬11å¸§ï¼šé”€æ¯

### 3. PlayerComponent æ›´æ–°

```csharp
public struct PlayerComponent : IComponent
{
    public int currentIndex;         // 0=å¢™, 1=å­å¼¹, 2=æ²¹æ¡¶
    public int sumIndex;             // æ€»æ¨¡å¼æ•° = 3
    public Fix64 barrelCooldownTimer; // æ²¹æ¡¶å†·å´
    
    public static Fix64 BarrelCooldownDuration = (Fix64)2; // å†·å´æ—¶é—´
}
```

---

## ğŸ”§ æ ¸å¿ƒç³»ç»Ÿ

### 1. PlayerPlaceBarrelSystemï¼ˆæ²¹æ¡¶æ”¾ç½®ç³»ç»Ÿï¼‰

**èŒè´£**ï¼š
- æ£€æµ‹ç©å®¶æ”¾ç½®æ²¹æ¡¶è¾“å…¥
- åˆ›å»ºæ²¹æ¡¶Entity
- æ·»åŠ æ‰€æœ‰å¿…éœ€ç»„ä»¶
- åº”ç”¨å†·å´æ—¶é—´

**è§¦å‘æ¡ä»¶**ï¼š
```csharp
currentIndex == 2  // æ²¹æ¡¶æ¨¡å¼
&& IsFire == true  // ç‚¹å‡»
&& barrelCooldownTimer <= 0  // å†·å´ç»“æŸ
```

**æ²¹æ¡¶ç»„ä»¶**ï¼š
```csharp
// Transform2DComponent
position = ç›®æ ‡ä½ç½®ï¼ˆé¼ æ ‡ç‚¹å‡»ä½ç½®ï¼‰

// PhysicsBodyComponent
isStatic = true       // é™æ€ï¼ˆä¸ç§»åŠ¨ï¼‰
isTrigger = false     // å®å¿ƒï¼ˆé˜»æŒ¡ç§»åŠ¨ï¼‰
layer = Wall          // ä½¿ç”¨å¢™Layer

// CollisionShapeComponent
shape = Circle
radius = 0.4

// HPComponent
hp = 50

// BarrelComponent
maxHp = 50
explosionRadius = 3
explosionDamage = 40
```

---

### 2. BarrelSystemï¼ˆæ²¹æ¡¶çˆ†ç‚¸ç³»ç»Ÿï¼‰

**èŒè´£**ï¼š
- æ£€æµ‹æ²¹æ¡¶è¡€é‡
- è§¦å‘çˆ†ç‚¸
- åˆ›å»ºçˆ†ç‚¸Entity
- é”€æ¯æ²¹æ¡¶Entity

**æ‰§è¡Œæµç¨‹**ï¼š
```
æ¯å¸§ï¼š
1. éå†æ‰€æœ‰BarrelComponent
2. æ£€æŸ¥ currentHp <= 0 æˆ– isDestroyed
3. å¦‚æœæ˜¯ï¼š
   - åˆ›å»ºExplosionEntity
   - é”€æ¯BarrelEntity
```

**åˆ›å»ºçˆ†ç‚¸**ï¼š
```csharp
Entity explosionEntity = world.CreateEntity();
world.AddComponent(explosionEntity, new Transform2DComponent(position));
world.AddComponent(explosionEntity, ExplosionComponent.Create(
    position,
    explosionRadius,
    explosionDamage,
    ownerId
));
```

---

### 3. ExplosionSystemï¼ˆçˆ†ç‚¸ä¼¤å®³ç³»ç»Ÿï¼‰

**èŒè´£**ï¼š
- åœ¨çˆ†ç‚¸ç¬¬ä¸€å¸§é€ æˆèŒƒå›´ä¼¤å®³
- æ›´æ–°çˆ†ç‚¸ç”Ÿå‘½å‘¨æœŸ
- é”€æ¯è¿‡æœŸçˆ†ç‚¸

**æ‰§è¡Œæµç¨‹**ï¼š
```
æ¯å¸§ï¼š
1. éå†æ‰€æœ‰ExplosionComponent
2. å¦‚æœ !hasDealDamageï¼š
   - ä½¿ç”¨QueryCircleRegionæŸ¥è¯¢èŒƒå›´å†…Entity
   - å¯¹æœ‰HPComponentçš„Entityé€ æˆä¼¤å®³
   - å¯¹BarrelComponentè°ƒç”¨TakeDamageï¼ˆè¿é”çˆ†ç‚¸ï¼‰
   - æ ‡è®° hasDealDamage = true
3. currentFrame++
4. å¦‚æœ currentFrame >= lifetimeFramesï¼š
   - é”€æ¯çˆ†ç‚¸Entity
```

**ä¼¤å®³è§„åˆ™**ï¼š
```csharp
// æŸ¥è¯¢èŒƒå›´å†…æ‰€æœ‰Entity
var entitiesInRange = physicsSystem.QueryCircleRegion(
    world,
    explosion.position,
    explosion.radius,
    -1  // æ‰€æœ‰Layer
);

foreach (var entity in entitiesInRange)
{
    // å¯¹æœ‰HPComponentçš„é€ æˆä¼¤å®³
    if (world.TryGetComponent<HPComponent>(entity, out var hp))
    {
        hp.hp -= explosion.damage;
        world.AddComponent(entity, hp);
    }
    
    // ç‰¹æ®Šå¤„ç†ï¼šè¿é”å¼•çˆ†æ²¹æ¡¶
    if (world.TryGetComponent<BarrelComponent>(entity, out var barrel))
    {
        barrel.TakeDamage(explosion.damage);
        world.AddComponent(entity, barrel);
    }
}
```

---

### 4. BulletCheckSystem æ›´æ–°

**æ–°å¢åŠŸèƒ½**ï¼šå­å¼¹å¯ä»¥ä¼¤å®³æ²¹æ¡¶

```csharp
else if (world.TryGetComponent<BarrelComponent>(new Entity(entityId), out var barrelComponent))
{
    Entity barrelEntity = new Entity(entityId);
    
    // å­å¼¹å‡»ä¸­æ²¹æ¡¶ï¼Œé€ æˆä¼¤å®³
    if (!barrelComponent.isDestroyed)
    {
        var updatedBarrel = barrelComponent;
        bool destroyed = updatedBarrel.TakeDamage((Fix64)bulletComponent.damage);
        world.AddComponent(barrelEntity, updatedBarrel);
        
        if (destroyed)
        {
            Debug.Log("æ²¹æ¡¶è¢«æ‰“çˆ†ï¼å‡†å¤‡çˆ†ç‚¸...");
        }
    }
    
    // å­å¼¹é”€æ¯
    removedEntities.Add(entity);
}
```

---

### 5. PlayerCooldownSystem æ›´æ–°

**æ–°å¢åŠŸèƒ½**ï¼šå¤„ç†æ²¹æ¡¶å†·å´

```csharp
// å‡å°‘æ²¹æ¡¶å†·å´æ—¶é—´
if (updatedPlayer.barrelCooldownTimer > Fix64.Zero)
{
    updatedPlayer.barrelCooldownTimer -= deltaTime;
    if (updatedPlayer.barrelCooldownTimer < Fix64.Zero)
    {
        updatedPlayer.barrelCooldownTimer = Fix64.Zero;
    }
}
```

---

## ğŸ® ä½¿ç”¨æ–¹æ³•

### 1. åˆå§‹åŒ–ï¼ˆå·²è‡ªåŠ¨é›†æˆï¼‰

```csharp
// ECSStateMachine.InitializeDefaultSystems()
RegisterSystem(new PlayerPlaceBarrelSystem());
RegisterSystem(new BarrelSystem());
RegisterSystem(new ExplosionSystem());
```

**Systemæ‰§è¡Œé¡ºåº**ï¼š
```
FlowFieldSystem
PlayerToggleSystem        // åˆ‡æ¢æ¨¡å¼ï¼ˆTabé”®ï¼‰
PlayerCooldownSystem      // å†·å´
StiffSystem
DeathSystem
WallPlacementSystem
PlayerMoveSystem
PlayerShootSystem
PlayerPlaceWallSystem     // æ”¾ç½®å¢™
PlayerPlaceBarrelSystem   // æ”¾ç½®æ²¹æ¡¶ â­
BulletCheckSystem         // å­å¼¹æ£€æµ‹ï¼ˆåŒ…æ‹¬ä¼¤å®³æ²¹æ¡¶ï¼‰â­
BarrelSystem              // æ²¹æ¡¶çˆ†ç‚¸æ£€æµ‹ â­
ExplosionSystem           // çˆ†ç‚¸ä¼¤å®³å¤„ç† â­
PhysicsSystem
ZombieSpawnSystem
ZombieAISystem
```

---

### 2. ç©å®¶æ“ä½œ

#### åˆ‡æ¢åˆ°æ²¹æ¡¶æ¨¡å¼

```csharp
// æŒ‰Tabé”®åˆ‡æ¢æ¨¡å¼
currentIndex = 2  // å¢™(0) -> å­å¼¹(1) -> æ²¹æ¡¶(2)
```

#### æ”¾ç½®æ²¹æ¡¶

```csharp
// åœ¨æ²¹æ¡¶æ¨¡å¼ï¼ˆcurrentIndex == 2ï¼‰
// ç‚¹å‡»é¼ æ ‡å·¦é”®ï¼ˆIsFire = trueï¼‰
// åœ¨ç‚¹å‡»ä½ç½®åˆ›å»ºæ²¹æ¡¶
```

#### å°„å‡»æ²¹æ¡¶

```csharp
// åˆ‡æ¢åˆ°å­å¼¹æ¨¡å¼ï¼ˆcurrentIndex == 1ï¼‰
// å°„å‡»æ²¹æ¡¶
// æ²¹æ¡¶è¡€é‡å‡å°‘
// è¡€é‡å½’é›¶æ—¶çˆ†ç‚¸
```

---

### 3. ä»£ç ç¤ºä¾‹

#### æ‰‹åŠ¨åˆ›å»ºæ²¹æ¡¶

```csharp
Entity barrel = world.CreateEntity();

world.AddComponent(barrel, new Transform2DComponent(position));
world.AddComponent(barrel, BarrelComponent.CreateDefault(playerId));
world.AddComponent(barrel, new PhysicsBodyComponent(
    isStatic: true,
    useGravity: false,
    isTrigger: false,
    restitution: Fix64.Zero,
    friction: Fix64.Zero,
    linearDamping: Fix64.Zero,
    (int)PhysicsLayer.Wall
));
world.AddComponent(barrel, CollisionShapeComponent.CreateCircle((Fix64)0.4f));
world.AddComponent(barrel, new VelocityComponent());
world.AddComponent(barrel, new HPComponent(50));
```

#### æ‰‹åŠ¨å¼•çˆ†æ²¹æ¡¶

```csharp
if (world.TryGetComponent<BarrelComponent>(barrelEntity, out var barrel))
{
    var updatedBarrel = barrel;
    updatedBarrel.TakeDamage(barrel.currentHp); // é€ æˆè‡´å‘½ä¼¤å®³
    world.AddComponent(barrelEntity, updatedBarrel);
}
```

#### æ‰‹åŠ¨åˆ›å»ºçˆ†ç‚¸

```csharp
Entity explosion = world.CreateEntity();

world.AddComponent(explosion, new Transform2DComponent(position));
world.AddComponent(explosion, ExplosionComponent.Create(
    position,
    (Fix64)3,  // èŒƒå›´
    (Fix64)40, // ä¼¤å®³
    playerId
));
```

---

## ğŸ¨ æ¸¸æˆç©æ³•ç¤ºä¾‹

### åœºæ™¯1ï¼šé˜²å®ˆé™·é˜±

```
1. ç©å®¶åœ¨è·¯å£æ”¾ç½®æ²¹æ¡¶
2. åƒµå°¸ç¾¤é è¿‘
3. ç©å®¶å°„å‡»æ²¹æ¡¶
4. çˆ†ç‚¸å‡»æ€å¤šä¸ªåƒµå°¸
```

### åœºæ™¯2ï¼šè¿é”çˆ†ç‚¸

```
1. ç©å®¶æ”¾ç½®3ä¸ªæ²¹æ¡¶ï¼ˆé—´éš”2å•ä½ï¼‰
2. å°„å‡»ç¬¬1ä¸ªæ²¹æ¡¶
3. ç¬¬1ä¸ªçˆ†ç‚¸ï¼ˆèŒƒå›´3ï¼‰å¼•çˆ†ç¬¬2ä¸ª
4. ç¬¬2ä¸ªçˆ†ç‚¸å¼•çˆ†ç¬¬3ä¸ª
5. è¿é”çˆ†ç‚¸æ¸…åœº
```

### åœºæ™¯3ï¼šå¢™+æ²¹æ¡¶ç»„åˆ

```
1. ç©å®¶æ”¾ç½®å¢™ä½“è¿·å®«
2. åœ¨æ‹è§’å¤„æ”¾ç½®æ²¹æ¡¶
3. åƒµå°¸è¿›å…¥è¿·å®«
4. å°„å‡»æ²¹æ¡¶ï¼Œå¢™ä½“é˜»æŒ¡çˆ†ç‚¸æ‰©æ•£
5. ç²¾å‡†æ¸…ç†ç‰¹å®šåŒºåŸŸ
```

---

## âš™ï¸ é…ç½®å‚æ•°

### æ²¹æ¡¶å‚æ•°

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ | æ¨èèŒƒå›´ |
|------|--------|------|----------|
| `maxHp` | 50 | æœ€å¤§è¡€é‡ | 30-100 |
| `explosionRadius` | 3 | çˆ†ç‚¸èŒƒå›´ | 2-5 |
| `explosionDamage` | 40 | çˆ†ç‚¸ä¼¤å®³ | 20-100 |
| `BarrelCooldownDuration` | 2 | æ”¾ç½®å†·å´ï¼ˆå¸§ï¼‰ | 1-5 |

### è°ƒæ•´æ–¹æ³•

```csharp
// æ–¹æ³•1ï¼šä¿®æ”¹é»˜è®¤å€¼
BarrelComponent.CreateDefault() ä¸­çš„å€¼

// æ–¹æ³•2ï¼šè¿è¡Œæ—¶ä¿®æ”¹
if (world.TryGetComponent<BarrelComponent>(entity, out var barrel))
{
    var updated = barrel;
    updated.explosionRadius = (Fix64)5;  // æ‰©å¤§çˆ†ç‚¸èŒƒå›´
    updated.explosionDamage = (Fix64)100; // å¢åŠ ä¼¤å®³
    world.AddComponent(entity, updated);
}

// æ–¹æ³•3ï¼šä¿®æ”¹å†·å´æ—¶é—´
PlayerComponent.BarrelCooldownDuration = (Fix64)3;
```

---

## ğŸ§ª æµ‹è¯•å»ºè®®

### 1. åŸºç¡€åŠŸèƒ½æµ‹è¯•

```
âœ… åˆ‡æ¢åˆ°æ²¹æ¡¶æ¨¡å¼
âœ… æ”¾ç½®æ²¹æ¡¶
âœ… æ²¹æ¡¶å‡ºç°åœ¨æ­£ç¡®ä½ç½®
âœ… æ²¹æ¡¶é˜»æŒ¡ç©å®¶ç§»åŠ¨
âœ… å°„å‡»æ²¹æ¡¶
âœ… æ²¹æ¡¶è¡€é‡å‡å°‘
âœ… è¡€é‡å½’é›¶æ—¶çˆ†ç‚¸
âœ… æ²¹æ¡¶Entityè¢«é”€æ¯
```

### 2. ä¼¤å®³æµ‹è¯•

```
âœ… çˆ†ç‚¸ä¼¤å®³ç©å®¶
âœ… çˆ†ç‚¸ä¼¤å®³åƒµå°¸
âœ… çˆ†ç‚¸ä¼¤å®³å¢™ä½“
âœ… çˆ†ç‚¸ä¼¤å®³å…¶ä»–æ²¹æ¡¶
âœ… èŒƒå›´å¤–ä¸å—ä¼¤å®³
```

### 3. è¿é”çˆ†ç‚¸æµ‹è¯•

```
1. æ”¾ç½®3ä¸ªæ²¹æ¡¶ï¼ˆé—´éš”2å•ä½ï¼‰
2. å°„å‡»ç¬¬1ä¸ª
3. è§‚å¯Ÿè¿é”çˆ†ç‚¸
4. ç¡®è®¤æ‰€æœ‰æ²¹æ¡¶éƒ½è¢«å¼•çˆ†
```

### 4. è¾¹ç•Œæµ‹è¯•

```
âœ… å†·å´æ—¶é—´å†…æ— æ³•æ”¾ç½®
âœ… å†·å´ç»“æŸåå¯ä»¥æ”¾ç½®
âœ… æ²¹æ¡¶è¡€é‡ä¸º0æ—¶ç«‹å³çˆ†ç‚¸
âœ… çˆ†ç‚¸10å¸§åè‡ªåŠ¨é”€æ¯
âœ… å·²æ‘§æ¯çš„æ²¹æ¡¶ä¸å†å—ä¼¤å®³
```

---

## ğŸ› å¸¸è§é—®é¢˜

### Q1: æ²¹æ¡¶æ”¾ç½®åæ²¡æœ‰æ˜¾ç¤ºï¼Ÿ
**A**: éœ€è¦åœ¨Unityä¸­æ·»åŠ æ²¹æ¡¶çš„è§†è§‰è¡¨ç°ï¼š
```csharp
// åœ¨ECSSyncHelperæˆ–ç±»ä¼¼çš„Syncè„šæœ¬ä¸­æ·»åŠ 
if (world.TryGetComponent<BarrelComponent>(entity, out _))
{
    // åˆ›å»ºæˆ–æ›´æ–°æ²¹æ¡¶GameObject
    var barrelGO = GetOrCreateBarrelGameObject(entity);
    barrelGO.transform.position = transform.position.ToVector3();
}
```

### Q2: çˆ†ç‚¸æ²¡æœ‰ä¼¤å®³ï¼Ÿ
**A**: æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š
1. ExplosionSystemæ˜¯å¦å·²æ³¨å†Œ
2. çˆ†ç‚¸çš„`hasDealDamage`æ˜¯å¦è¢«æ­£ç¡®è®¾ç½®
3. ç›®æ ‡Entityæ˜¯å¦æœ‰HPComponent
4. çˆ†ç‚¸èŒƒå›´æ˜¯å¦è¶³å¤Ÿå¤§

### Q3: è¿é”çˆ†ç‚¸ä¸å·¥ä½œï¼Ÿ
**A**: ç¡®ä¿ï¼š
1. BarrelSystemåœ¨ExplosionSystemä¹‹å‰æ‰§è¡Œ
2. ExplosionSystemä¸­çš„BarrelComponentå¤„ç†é€»è¾‘æ­£ç¡®
3. æ²¹æ¡¶é—´è·å°äºçˆ†ç‚¸èŒƒå›´

### Q4: æ²¹æ¡¶æ— æ³•æ”¾ç½®ï¼Ÿ
**A**: æ£€æŸ¥ï¼š
1. currentIndexæ˜¯å¦ä¸º2
2. barrelCooldownTimeræ˜¯å¦ä¸º0
3. IsFireæ˜¯å¦ä¸ºtrue
4. ä½ç½®æ˜¯å¦æœ‰æ•ˆ

---

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### 1. çˆ†ç‚¸æ£€æµ‹ä¼˜åŒ–

```csharp
// âœ… å¥½ï¼šä½¿ç”¨ç‰©ç†ç³»ç»Ÿçš„QueryCircleRegion
var entities = physicsSystem.QueryCircleRegion(
    world, position, radius, -1
);

// âŒ ä¸å¥½ï¼šéå†æ‰€æœ‰Entity
foreach (var entity in world.GetAllEntities())
{
    // æ•ˆç‡å¤ªä½
}
```

### 2. è¿é”çˆ†ç‚¸ä¿æŠ¤

```csharp
// é˜²æ­¢æ— é™é€’å½’çˆ†ç‚¸
if (!barrel.isDestroyed)
{
    barrel.TakeDamage(damage);
    // åªæœ‰æœªæ‘§æ¯çš„æ²¹æ¡¶æ‰ä¼šè¢«å¼•çˆ†
}
```

### 3. çˆ†ç‚¸ç”Ÿå‘½å‘¨æœŸ

```csharp
// çˆ†ç‚¸10å¸§åè‡ªåŠ¨é”€æ¯ï¼Œé¿å…å†…å­˜æ³„æ¼
if (explosion.currentFrame >= explosion.lifetimeFrames)
{
    world.DestroyEntity(explosionEntity);
}
```

---

## ğŸ¯ è¿›é˜¶åŠŸèƒ½

### 1. å¯æ¨åŠ¨çš„æ²¹æ¡¶

```csharp
// å°†æ²¹æ¡¶æ”¹ä¸ºåŠ¨æ€ç‰©ä½“
var physicsBodyComponent = new PhysicsBodyComponent(
    isStatic: false,  // æ”¹ä¸ºåŠ¨æ€
    useGravity: false,
    isTrigger: false,
    mass: (Fix64)10,  // æ·»åŠ è´¨é‡
    restitution: (Fix64)0.3f,
    friction: (Fix64)0.5f,
    linearDamping: (Fix64)2,  // æ·»åŠ é˜»å°¼
    (int)PhysicsLayer.Wall
);
```

### 2. ä¸åŒç±»å‹çš„æ²¹æ¡¶

```csharp
public enum BarrelType
{
    Standard,   // æ™®é€šæ²¹æ¡¶
    Fire,       // ç«ç„°æ²¹æ¡¶ï¼ˆæŒç»­ä¼¤å®³ï¼‰
    Ice,        // å†°å†»æ²¹æ¡¶ï¼ˆå‡é€Ÿï¼‰
    Toxic       // æ¯’æ€§æ²¹æ¡¶ï¼ˆDoTï¼‰
}

public struct BarrelComponent : IComponent
{
    public BarrelType type;
    // ...
}
```

### 3. å»¶è¿Ÿçˆ†ç‚¸

```csharp
public struct BarrelComponent : IComponent
{
    public int explosionDelayFrames;  // å»¶è¿Ÿå¸§æ•°
    public int explosionTimer;        // å½“å‰è®¡æ—¶
    // ...
}

// åœ¨BarrelSystemä¸­
if (barrel.currentHp <= 0)
{
    barrel.explosionTimer++;
    if (barrel.explosionTimer >= barrel.explosionDelayFrames)
    {
        // çˆ†ç‚¸
    }
}
```

### 4. çˆ†ç‚¸è§†è§‰æ•ˆæœ

```csharp
public struct ExplosionComponent : IComponent
{
    public ExplosionVFXType vfxType;  // è§†è§‰æ•ˆæœç±»å‹
    // Small, Medium, Large, Fire, Ice, etc.
}
```

---

## ğŸ“š APIå‚è€ƒ

### BarrelComponent

| æ–¹æ³• | è¯´æ˜ | è¿”å›å€¼ |
|------|------|--------|
| `CreateDefault(int ownerId)` | åˆ›å»ºé»˜è®¤é…ç½®çš„æ²¹æ¡¶ | `BarrelComponent` |
| `TakeDamage(Fix64 damage)` | å—åˆ°ä¼¤å®³ | `bool`ï¼ˆæ˜¯å¦è¢«æ‘§æ¯ï¼‰ |
| `GetHpPercentage()` | è·å–è¡€é‡ç™¾åˆ†æ¯” | `Fix64` |

### ExplosionComponent

| æ–¹æ³• | è¯´æ˜ | è¿”å›å€¼ |
|------|------|--------|
| `Create(FixVector2 pos, Fix64 radius, Fix64 damage, int owner)` | åˆ›å»ºçˆ†ç‚¸ | `ExplosionComponent` |

### PlayerComponent

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `currentIndex` | `int` | å½“å‰æ¨¡å¼ï¼ˆ2=æ²¹æ¡¶ï¼‰ |
| `barrelCooldownTimer` | `Fix64` | æ²¹æ¡¶å†·å´è®¡æ—¶å™¨ |
| `BarrelCooldownDuration` | `Fix64` | æ²¹æ¡¶å†·å´æ—¶é—´ï¼ˆé™æ€ï¼‰ |

---

## ğŸ‰ æ€»ç»“

### æ ¸å¿ƒç‰¹æ€§

1. âœ… **å®Œæ•´çš„æ²¹æ¡¶ç³»ç»Ÿ**
   - æ”¾ç½®ã€ä¼¤å®³ã€çˆ†ç‚¸ã€è¿é”

2. âœ… **æ¨¡å—åŒ–è®¾è®¡**
   - Componentï¼šBarrelComponent, ExplosionComponent
   - Systemï¼šBarrelSystem, ExplosionSystem, PlayerPlaceBarrelSystem

3. âœ… **æ˜“äºæ‹“å±•**
   - æ”¯æŒä¸åŒç±»å‹æ²¹æ¡¶
   - æ”¯æŒè‡ªå®šä¹‰çˆ†ç‚¸æ•ˆæœ
   - æ”¯æŒè°ƒæ•´å‚æ•°

4. âœ… **æ€§èƒ½ä¼˜åŒ–**
   - ä½¿ç”¨QuadTreeåŠ é€ŸèŒƒå›´æŸ¥è¯¢
   - è‡ªåŠ¨æ¸…ç†è¿‡æœŸçˆ†ç‚¸
   - é˜²æ­¢æ— é™é€’å½’

### å¿«é€Ÿä¸Šæ‰‹

```csharp
// 1. åˆ‡æ¢åˆ°æ²¹æ¡¶æ¨¡å¼
currentIndex = 2

// 2. ç‚¹å‡»æ”¾ç½®
IsFire = true

// 3. å°„å‡»å¼•çˆ†
// æ²¹æ¡¶çˆ†ç‚¸ï¼ŒèŒƒå›´ä¼¤å®³
```

---

**æ²¹æ¡¶ç³»ç»Ÿå·²å®Œæˆï¼äº«å—è¿é”çˆ†ç‚¸çš„å¿«æ„Ÿå§ï¼** ğŸ’¥

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0  
**åˆ›å»ºæ—¥æœŸ**: 2026-01-20  
**ç³»ç»Ÿ**: æ²¹æ¡¶ä¸çˆ†ç‚¸ç³»ç»Ÿ



