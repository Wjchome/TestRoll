# 子弹视觉表现实现说明

## 已实现的功能

### 1. ECSSyncHelper 扩展
新增了子弹同步功能，会自动：
- 为 ECS 中的子弹 Entity 创建对应的 Unity GameObject
- 更新子弹的位置
- 当子弹从 ECS 中移除时，自动销毁 GameObject

### 2. 自动创建子弹视觉对象
如果没有设置子弹预制体，系统会自动创建一个：
- 红色小球（Sphere）
- 缩放为 0.2 倍大小
- 无碰撞体（仅视觉表现）

### 3. 自定义子弹预制体（可选）
可以在 Unity 编辑器中设置自定义的子弹预制体：

```
ECSFrameSyncExample 组件 Inspector 面板：
┌─────────────────────────────────┐
│ 玩家设置                          │
│   Player Prefab: [拖拽玩家预制体]  │
│                                  │
│ 子弹设置                          │
│   Bullet Prefab: [拖拽子弹预制体]  │ ← 可选，不设置会自动创建红色小球
└─────────────────────────────────┘
```

## 使用方式

### 方式一：使用默认子弹（无需操作）
直接运行游戏，点击鼠标左键发射子弹，会自动创建红色小球作为视觉表现。

### 方式二：使用自定义子弹预制体

1. **创建子弹预制体**：
   - 在 Unity 场景中创建一个 GameObject（例如：Sprite 或 3D 模型）
   - 设置子弹的外观（颜色、材质、贴图等）
   - 调整大小（建议 0.2 左右）
   - 拖拽到 Project 面板创建 Prefab

2. **设置预制体**：
   - 选中场景中的 `ECSFrameSyncExample` 对象
   - 在 Inspector 面板中找到 "子弹设置" 部分
   - 将创建的子弹预制体拖拽到 `Bullet Prefab` 字段

3. **运行测试**：
   - 运行游戏
   - 点击鼠标左键发射子弹
   - 现在会使用你自定义的预制体

## 技术细节

### 子弹生命周期

```
玩家点击鼠标
    ↓
ECSFrameSyncExample 检测输入
    ↓
发送到服务器 + 本地预测
    ↓
ECSStateMachine 创建 BulletComponent（ECS 逻辑层）
    ↓
ECSSyncHelper.SyncBullets() 创建 GameObject（视觉层）
    ↓
每帧更新子弹位置
    ↓
子弹超出范围，从 ECS 中移除
    ↓
ECSSyncHelper.SyncBullets() 销毁 GameObject
```

### 代码结构

- **逻辑层（ECS）**：`BulletComponent` 存储子弹的位置、速度、归属等数据
- **视觉层（Unity）**：`ECSSyncHelper` 负责创建/更新/销毁 GameObject
- **分离关注点**：逻辑和视觉完全分离，便于回滚和多端同步

### 性能优化建议

如果需要大量子弹，可以考虑：
1. 使用对象池（Object Pool）避免频繁创建/销毁
2. 使用 GPU Instancing 或 ECS Rendering
3. 限制最大子弹数量

## 当前实现的特性

✅ 自动创建/销毁子弹 GameObject  
✅ 支持自定义预制体  
✅ 提供默认视觉表现（红色小球）  
✅ 子弹位置实时同步  
✅ 支持预测回滚（子弹会跟随回滚）  

## 后续可扩展功能

- [ ] 子弹对象池
- [ ] 子弹命中特效
- [ ] 子弹轨迹渲染
- [ ] 子弹碰撞检测（目前只有移动）
- [ ] 子弹伤害计算

